<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Volunteer Sign Up / Sign In</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css"
      rel="stylesheet"
    />
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <script type="module">
      // Firebase imports and configuration remain the same
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
      import {
        getAuth,
        signInWithEmailAndPassword,
        createUserWithEmailAndPassword,
      } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
      import {
        getDatabase,
        ref,
        set,
        get,
        child,
        update,
        remove,
      } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDdZDK-BrKpSA-BIzPory1HG9Kljr3m7PI",
        authDomain: "saveplate-c246d.firebaseapp.com",
        projectId: "saveplate-c246d",
        storageBucket: "saveplate-c246d.firebasestorage.app",
        messagingSenderId: "120081276324",
        appId: "1:120081276324:web:16985cfc7662a80502b531",
        measurementId: "G-75P3TNTKK7",
        databaseURL: "https://saveplate-c246d-default-rtdb.firebaseio.com/",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const database = getDatabase(app);
      const auth = getAuth(app);

      // Function implementations remain the same
      window.signUp = async function () {
        const email = document.getElementById("signup-email").value;
        const password = document.getElementById("signup-password").value;
        const name = document.getElementById("signup-name").value;
        const signupError = document.getElementById("signup-error");
        try {
          const userCredential = await createUserWithEmailAndPassword(
            auth,
            email,
            password
          );
          const user = userCredential.user;
          const role = "Volunteer";
          await set(ref(database, "users/" + user.uid), {
            name: name,
            email: email,
            role: role,
          });
          localStorage.setItem("userRole", role);
          signupError.textContent = "Account created successfully. Please sign in.";
          toggleForm('signin');
        } catch (error) {
          signupError.textContent = error.message;
        }
      };

      window.signIn = async function () {
        const email = document.getElementById("signin-email").value;
        const password = document.getElementById("signin-password").value;
        const signinError = document.getElementById("signin-error");
        try {
          const userCredential = await signInWithEmailAndPassword(
            auth,
            email,
            password
          );
          const user = userCredential.user;
          const userSnapshot = await get(ref(database, "users/" + user.uid));
          if (userSnapshot.exists()) {
            const userData = userSnapshot.val();
            const userRole = userData.role;
            localStorage.setItem("userUid", user.uid);
            localStorage.setItem("userRole", userRole);
            signinError.textContent = "Sign in successful.";
            window.location.href = "volunteerhome.html";
          } else {
            signinError.textContent = "No user data found.";
          }
        } catch (error) {
          signinError.textContent = error.message;
        }
      };

      window.toggleForm = function (formType) {
        if (formType === "signup") {
          document.getElementById("signup-form").style.display = "block";
          document.getElementById("signin-form").style.display = "none";
        } else {
          document.getElementById("signup-form").style.display = "none";
          document.getElementById("signin-form").style.display = "block";
        }
      };
    </script>
    <style>
      .form-label {
        @apply block text-sm font-medium text-gray-700 mb-1;
      }
      .form-input {
        @apply w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500;
      }
      .btn-primary {
        @apply w-full bg-green-700 hover:bg-green-800 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition-all focus:ring-2 focus:ring-offset-2 focus:ring-green-500;
      }
      .link-text {
        @apply text-green-700 hover:text-green-800 hover:underline focus:outline-none focus:ring-2 focus:ring-green-500;
      }
    </style>
  </head>
  <body class="bg-green-100 flex items-center justify-center min-h-screen">
    <div class="w-full max-w-4xl p-8 space-y-8 bg-white rounded-lg shadow-md flex">
      <div class="hidden md:block w-1/2">
        <img
          src="loginimage.jpg"
          alt="Food donation volunteer work"
          class="w-full h-full object-cover rounded-lg"
        />
      </div>
      <div class="w-full md:w-1/2 max-w-md p-8 space-y-8">
        <h1 class="text-3xl font-bold text-center text-green-800">
          Save Plate - Volunteer
        </h1>

        <!-- Sign Up Form -->
        <form id="signup-form" class="space-y-6" novalidate>
          <h2 class="text-2xl font-semibold text-green-800 mb-4">Sign Up</h2>
          <div class="space-y-4">
            <div>
              <label for="signup-name" class="form-label">Name</label>
              <input
                type="text"
                id="signup-name"
                name="signup-name"
                class="form-input"
                required
                aria-required="true"
              />
            </div>
            <div>
              <label for="signup-email" class="form-label">Email</label>
              <input
                type="email"
                id="signup-email"
                name="signup-email"
                class="form-input"
                required
                aria-required="true"
              />
            </div>
            <div>
              <label for="signup-password" class="form-label">Password</label>
              <input
                type="password"
                id="signup-password"
                name="signup-password"
                class="form-input"
                required
                aria-required="true"
                minlength="6"
              />
            </div>
            <p id="signup-error" class="text-red-600" role="alert" aria-live="polite"></p>
            <button
              type="button"
              onclick="signUp()"
              class="btn-primary"
            >
              Sign Up
            </button>
            <p class="text-center text-gray-700">
              Have an account already?
              <button 
                type="button"
                onclick="toggleForm('signin')"
                class="link-text"
              >
                Sign In
              </button>
            </p>
          </div>
        </form>

        <!-- Sign In Form -->
        <form id="signin-form" class="space-y-6" style="display: none" novalidate>
          <h2 class="text-2xl font-semibold text-green-800 mb-4">Sign In</h2>
          <div class="space-y-4">
            <div>
              <label for="signin-email" class="form-label">Email</label>
              <input
                type="email"
                id="signin-email"
                name="signin-email"
                class="form-input"
                required
                aria-required="true"
              />
            </div>
            <div>
              <label for="signin-password" class="form-label">Password</label>
              <input
                type="password"
                id="signin-password"
                name="signin-password"
                class="form-input"
                required
                aria-required="true"
              />
            </div>
            <p id="signin-error" class="text-red-600" role="alert" aria-live="polite"></p>
            <button
              type="button"
              onclick="signIn()"
              class="btn-primary"
            >
              Sign In
            </button>
            <p class="text-center text-gray-700">
              Don't have an account?
              <button 
                type="button"
                onclick="toggleForm('signup')"
                class="link-text"
              >
                Sign Up
              </button>
            </p>
          </div>
        </form>
      </div>
    </div>
  </body>
</html>
