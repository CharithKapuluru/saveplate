<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Volunteer Sign Up / Sign In</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css"
      rel="stylesheet"
    />
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
      import {
        getAuth,
        signInWithEmailAndPassword,
        createUserWithEmailAndPassword,
      } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
      import {
        getDatabase,
        ref,
        set,
        get,
        child,
        update,
        remove,
      } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyDdZDK-BrKpSA-BIzPory1HG9Kljr3m7PI",
        authDomain: "saveplate-c246d.firebaseapp.com",
        projectId: "saveplate-c246d",
        storageBucket: "saveplate-c246d.firebasestorage.app",
        messagingSenderId: "120081276324",
        appId: "1:120081276324:web:16985cfc7662a80502b531",
        measurementId: "G-75P3TNTKK7",
        databaseURL: "https://saveplate-c246d-default-rtdb.firebaseio.com/",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const database = getDatabase(app);
      const auth = getAuth(app);

      window.signUp = async function () {
        const email = document.getElementById("signup-email").value;
        const password = document.getElementById("signup-password").value;
        const name = document.getElementById("signup-name").value;
        const signupError = document.getElementById("signup-error");

        try {
          // Use createUserWithEmailAndPassword from firebase-auth.js
          const userCredential = await createUserWithEmailAndPassword(
            auth,
            email,
            password
          );
          const user = userCredential.user;
          const role = "Volunteer";

          // Store user information in Firebase Realtime Database
          await set(ref(database, "users/" + user.uid), {
            name: name,
            email: email,
            role: role,
          });

          // Store the role in localStorage for later use
          localStorage.setItem("userRole", role);

          signupError.textContent =
            "Account created successfully. Please sign in.";
          toggleForm("signin");
        } catch (error) {
          signupError.textContent = error.message;
        }
      };

      window.signIn = async function () {
        const email = document.getElementById("signin-email").value;
        const password = document.getElementById("signin-password").value;
        const signinError = document.getElementById("signin-error");

        try {
          // Use signInWithEmailAndPassword from firebase-auth.js
          const userCredential = await signInWithEmailAndPassword(
            auth,
            email,
            password
          );
          const user = userCredential.user;

          // Fetch the user's role from the database after signing in
          const userSnapshot = await get(ref(database, "users/" + user.uid));
          if (userSnapshot.exists()) {
            const userData = userSnapshot.val();
            const userRole = userData.role;

            // Store the id and role in localStorage for future use
            localStorage.setItem("userUid", user.uid);
            localStorage.setItem("userRole", userRole);

            signinError.textContent = "Sign in successful.";
            window.location.href = "volunteerhome.html";
          } else {
            console.error("No user data found");
            signinError.textContent = "No user data found.";
          }
        } catch (error) {
          console.error("Error signing in: ", error);
          signinError.textContent = error.message;
        }
      };

      window.toggleForm = function (formType) {
        if (formType === "signup") {
          document.getElementById("signup-form").style.display = "block";
          document.getElementById("signin-form").style.display = "none";
        } else {
          document.getElementById("signup-form").style.display = "none";
          document.getElementById("signin-form").style.display = "block";
        }
      };
    </script>
  </head>
  <body class="bg-green-100 flex items-center justify-center min-h-screen">
    <div
      class="w-full max-w-4xl p-8 space-y-8 bg-white rounded-lg shadow-md flex"
    >
      <div class="hidden md:block w-1/2">
        <img
          src="loginimage.jpg"
          alt="Volunteer Image"
          class="w-full h-full object-cover rounded-lg"
        />
      </div>
      <div class="w-full md:w-1/2 max-w-md p-8 space-y-8">
        <h2 class="text-3xl font-bold text-center text-green-700">
          Save Plate - Volunteer
        </h2>

        <div id="signup-form">
          <h3 class="text-xl font-semibold text-green-700 mb-4">Sign Up</h3>
          <div class="space-y-4">
            <input
              type="text"
              id="signup-name"
              name="signup-name"
              class="w-full px-4 py-2 border rounded-lg"
              placeholder="Name"
              required
            />
            <input
              type="email"
              id="signup-email"
              name="signup-email"
              class="w-full px-4 py-2 border rounded-lg"
              placeholder="Email"
              required
            />
            <input
              type="password"
              id="signup-password"
              name="signup-password"
              class="w-full px-4 py-2 border rounded-lg"
              placeholder="Password"
              required
            />
            <p id="signup-error" class="text-red-600"></p>
            <button
              type="button"
              onclick="signUp()"
              class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition-all"
            >
              Sign Up
            </button>
            <p class="text-center text-gray-700 mt-4">
              Have an account already?
              <a
                href="#"
                onclick="toggleForm('signin')"
                class="text-green-600 hover:underline"
                >Sign In</a
              >
            </p>
          </div>
        </div>

        <div id="signin-form" style="display: none">
          <h3 class="text-xl font-semibold text-green-700 mb-4">Sign In</h3>
          <div class="space-y-4">
            <input
              type="email"
              id="signin-email"
              name="signin-email"
              class="w-full px-4 py-2 border rounded-lg"
              placeholder="Email"
              required
            />
            <input
              type="password"
              id="signin-password"
              name="signin-password"
              class="w-full px-4 py-2 border rounded-lg"
              placeholder="Password"
              required
            />
            <p id="signin-error" class="text-red-600"></p>
            <button
              type="button"
              onclick="signIn()"
              class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition-all"
            >
              Sign In
            </button>
            <p class="text-center text-gray-700 mt-4">
              Don't have an account?
              <a
                href="#"
                onclick="toggleForm('signup')"
                class="text-green-600 hover:underline"
                >Sign Up</a
              >
            </p>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
